---
lab:
    title: 'ラボ 04: Azure Repos での Git によるバージョン管理'
    module: 'モジュール 4: エンタープライズ DevOps での Git のスケーリング'
---

# ラボ 04: Azure Repos の Git によるバージョン管理
# 受講生用ラボ マニュアル

## ラボの概要

Azure DevOps は、Git と Team Foundation バージョン管理 (TFVC) の 2 種類のバージョン管理をサポートしています。2 つのバージョン管理システムの概要は次のとおりです。

- **Team Foundation バージョン管理 (TFVC)**: TFVC は集中型バージョン管理システムです。通常、チームメンバーの開発マシンに、各ファイルには 1 つのバージョンしかありません。履歴データはサーバー上でのみ保持されます。ブランチはパスベースであり、サーバー上に作成されます。

- **Git**: Git は分散型バージョン管理システムです。Git リポジトリはローカルに存在できます (開発者のマシンなど)。各開発者は、開発マシンにソース リポジトリのコピーを持っています。開発者は、開発マシンで変更の各セットをコミットし、履歴などのバージョン管理操作を実行し、ネットワークに接続せずに比較することが可能です。

Git は、新しいプロジェクトの既定のバージョン管理プロバイダーです。TFVC で集中型バージョン管理機能が特に必要な場合を除いて、プロジェクトのバージョン管理には Git を使用する必要があります。

このラボでは、Azure DevOps でブランチとリポジトリを操作する方法を学習します。

## 目標

このラボを完了すると、次のことができるようになります。

-   Azure Repos でブランチを操作する
-   Azure Repos でリポジトリを操作する

## ラボの所要時間

-   推定時間: **30 分**

## 手順

### 開始する前に

#### ラボの仮想マシンにログインする

次の認証情報を使用して、Windows 10 仮想マシンにサインインしていることを確認します。
    
-   ユーザー名: **Student**
-   パスワード: **Pa55w.rd**

#### このラボで必要なアプリケーションのレビュー

このラボで使用するアプリケーションを特定:
       
-   Microsoft Edge
-   [Git for Windows ダウンロード ページ](https://gitforwindows.org/) 2.29.2 以降。このラボでは前提条件の一部としてインストールされます。 
-   [Visual Studio Code](https://code.visualstudio.com/) と [C#](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp) 拡張機能。これらは、このラボの前提条件の一部としてインストールされます。

#### Azure DevOps 組織を設定する 

このラボで使用できる Azure DevOps 組織がまだない場合は、[組織またはプロジェクト コレクションの作成](https://docs.microsoft.com/ja-jp/azure/devops/organizations/accounts/create-organization?view=azure-devops)で利用できる手順に従って作成してください。

### 演習 0: ラボの前提条件の構成

この演習では、ラボの前提条件を設定します。これには、Azure DevOps Demo Generator テンプレートと Visual Studio Code 構成に基づいて事前構成された Parts Unlimited チーム プロジェクトが含まれます。

#### タスク 1: チーム プロジェクトを構成する

このタスクでは、Azure DevOps Demo Generator を使用し、**Parts Unlimited** テンプレートに基づいて新しいプロジェクトを生成します。

1.  ラボのコンピューターで Web ブラウザーを起動し、[Azure DevOps Demo Generator](https://azuredevopsdemogenerator.azurewebsites.net) に移動します。このユーティリティ サイトは、ラボで必要なコンテンツ (作業項目、リポジトリなど) が事前設定されている新しい Azure DevOps プロジェクトをアカウント内で作成するプロセスを自動化します。 

    > **注**: サイトの詳細については、https://docs.microsoft.com/ja-jp/azure/devops/demo-gen をご覧ください。

1.  「**サインイン**」をクリックし、Azure DevOps サブスクリプションに関連のある Microsoft アカウントを使用してサインインします。
1.  必要な場合は、「**Azure DevOps Demo Generator**」ページで「**承諾する**」をクリックし、Azure DevOps サブスクリプションへのアクセス許可要求を承諾します。
1.  「**新しいプロジェクトの作成**」ページの 「**新しいプロジェクト名**」テキストボックスに、「**Azure リポジトリで Git を使用してバージョン管理**」と入力し、「**組織の選択**」ドロップダウン リストで、Azure DevOps 組織を選択して、「**テンプレートの選択**」をクリックします。
1.  テンプレートのリストで、**PartsUnlimited** テンプレートを見つけ、「**テンプレートの選択**」をクリックします。
1.  再び「**新しいプロジェクトの作成**」ページで「**プロジェクトの作成**」をクリックします。

    > **注**: プロセスが完了するまでお待ちください。これにはおよそ 2 分かかる場合があります。プロセスが失敗した場合は、DevOps 組織に移動し、プロジェクトを削除して、再試行してください。

1.  「**新しいプロジェクトの作成**」ページで「**プロジェクトに移動**」をクリックします。

#### タスク 2: Git と Visual Studio Code をインストールして構成する

このタスクでは、Git および Visual Studio Code をインストールおよび構成します。これには、Azure DevOps との通信に使用される Git 資格情報を安全に保存するための Git 資格情報ヘルパーの構成も含まれます。これらの前提条件をすでに実装している場合は、次のタスクに直接進むことができます。

1.  Git 2.29.2 以降をまだインストールしていない場合は、Web ブラウザーを起動し、[Git for Windows のダウンロード ページ](https://gitforwindows.org/)に移動してダウンロードし、インストールします。 
1.  Visual Studio Code をまだインストールしていない場合は、Web ブラウザー ウィンドウから [Visual Studio Code ダウンロード ページ](https://code.visualstudio.com/)に移動し、ダウンロードしてインストールします。 
1.  Visual Studio C# 拡張機能をまだインストールしていない場合は、Web ブラウザー ウィンドウで、[C# 拡張機能のインストール ページ](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp)に移動してインストールします。
1.  ラボ コンピューターで、**Visual Studio Code** を開きます。 
1.  Visual Studio Code インターフェイスで、メイン メニューから、「**ターミナル \| 新しいターミナル**」を選択して 「**ターミナル**」ペインを開きます。
1.  「**ターミナル**」ペインの右上隅にあるドロップダウン リストに **1: powershell** 表示されているかどうかを確認して、現在のターミナルが **PowerShell** を実行していることを確認します

    > **注**: 現在のターミナル シェルを **PowerShell** に変更するには、「**ターミナル**」ペインの右上隅のドロップダウン リストをクリックし、「**デフォルト シェルの選択**」をクリックします。Visual Studio Code ウィンドウの上部で、使用するターミナル シェル **Windows PowerShell** を選択し、ドロップダウン リストの右側にあるプラス記号をクリックして、選択したデフォルト シェルで新しいターミナルを開きます。

1.  「**ターミナル**」ペインで、以下のコマンドを実行して、資格情報ヘルパーを構成します。

    ```git
    git config --global credential.helper wincred
    ```
1.  「**ターミナル**」ペインで、次のコマンドを実行して、Git コミットのユーザー名とメールアドレスを設定します (中括弧内のプレース ホルダーをユーザー名とメールアドレスに置き換えます)。

    ```git
    git config --global user.name "<John Doe>"
    git config --global user.email <johndoe@example.com>
    ```

### 演習 1: 既存のリポジトリを複製する

この演習では、Visual Studio Code を使用して、前の演習の一部としてプロビジョニングした Git リポジトリのクローンを作成します。

#### タスク 1: 既存のリポジトリを複製する

このタスクでは、Visual Studio Code を使用して Git リポジトリを複製するプロセスを順を追って説明します。

1.  必要に応じて、Web ブラウザーを起動し、Azure DevOps 組織に移動して、前の演習で生成した **Azure Repos プロジェクトで Git を使用したバージョン管理**を開きます。 

    > **注**: または、[https://dev.azure.com/`<your-Azure-DevOps-account-name>`/Version%20Controlling%20with%20Git%20in%20Azure%20Repos](https://dev.azure.com/`<your-Azure-DevOps-account-name>`/Version%20Controlling%20with%20Git%20in%20Azure%20Repos) URL に移動して、プロジェクト ページに直接アクセスすることもできます。`<your-Azure-DevOps-account-name>` プレースホルダーは、アカウント名を表します。 

1.  DevOps インターフェイスの垂直ナビゲーション ペインで、「**リポジトリ**」 アイコンを選択します。
1.  「**PartsUnlimited**」ペインの右上隅にある 「**クローン**」をクリックします。

    > **注**: Git リポジトリのローカル コピーを取得することを*クローン作成*と呼びます。すべての主流の開発ツールはこれをサポートしており、Azure Repos に接続して、最新のソースをプル ダウンして操作できるようになります。「**リポジトリ**」 ハブに移動します。

1.  「**リポジトリの複製**」パネルで、**HTTPS** コマンドライン オプションを選択した状態で、リポジトリ クローン URL の横にある 「**クリップボードにコピー**」ボタンをクリックします。 

    > **注**: この URL を Git 互換ツールで使用して、コードベースのコピーを取得できます。

1.  「**リポジトリの複製**」パネルを閉じます。
1.  ラボ コンピューターで実行されている **Visual Studio Code** に切り替えます。 
1.  「**表示**」メニューヘ ッダーをクリックし、ドロップダウン メニューで 「**コマンド パレット**」をクリックします。 

    > **注**: コマンド パレットは、サードパーティの拡張機能として実装されているタスクを含む、さまざまなタスクにアクセスするための簡単で便利な方法を提供します。キーボード ショートカットの **Ctrl+Shift+P** を使用して開くことができます。

1.  コマンド パレット プロンプトで、**Git: Clone** コマンドを実行します。 

    > **注**: 関連するすべてのコマンドを表示するには、**Git** と入力することから始めます。

1.  「**リポジトリ URL を提供する」または 「リポジト リソースを選択する**」テキストボックスで、このタスクの前半でコピーしたリポジトリ クローン URL を貼り付け、**Enter** キーを押します。
1.  「**フォルダーの選択**」ダイアログ ボックスで、C: ドライブに移動し、Git という名前の新しいフォルダーを作成して選択し、「**リポジトリの場所の選択**」をクリックします。 
1.  プロンプトが表示されたら、Azure DevOps アカウントにログインします。
1.  複製プロセスが完了し、プロンプトが表示されたら、Visual Studio Code で 「**開く**」 をクリックして、複製されたリポジトリを開きます。 

    > **注**: プロジェクトのロードに関する問題に関して受け取る可能性のある警告は無視してかまいません。ソリューションはビルドに適した状態ではない可能性がありますが、Git での作業に重点を置くため、プロジェクトのビルドは必要ありません。

### 演習 2: Azure DevOps からブランチを管理する

この演習では、Azure DevOps を使用してブランチを操作します。Visual Studio Code で利用可能な機能に加えて、Azure DevOps ポータルから直接リポジトリ ブランチを管理できます。

#### タスク 1: 新しいブランチを作成する

このタスクでは、Azure DevOps ポータルを使用してブランチを作成し、Visual Studio Code を使用してそれをフェッチします。

1.  前の演習で生成した **Azure Repos プロジェクトの Git によるバージョン管理**を使用して Azure DevOps 組織を表示する Web ブラウザーに切り替えます。 

    > **注**: または、[https://dev.azure.com/`<your-Azure-DevOps-account-name>`/Version%20Controlling%20with%20Git%20in%20Azure%20Repos) URL に移動して、プロジェクト ページに直接アクセスすることもできます。ここで、`<your-Azure-DevOps-account-name>` プレースホルダーは、アカウント名を表します。 

1.  Web ブラウザー ウィンドウで、プロジェクトの 「**コミット**」 ペインに移動し、「**ブランチ**」 を選択します。
1.  「**ブランチ**」 ペインで、「**新しいブランチ**」 をクリックします。
1.  「**ブランチの作成**」 パネルの 「**名前**」 テキストボックスに「**release**」と入力し、「**ベース**」 ドロップダウン リスト、「**リンクする作業項目**」 ドロップダウン リストに**マスター**が表示されていることを確認し、使用可能な 1 つ以上の作業項目を選択して 「**作成**」 をクリックします。
1.  **Visual Studio Code** ウィンドウに切り替えます。 
1.  **Ctrl+Shift+P** を押して、**コマンド パレット**を開きます。
1.  **コマンド パレット** プロンプトで、「**Git: Fetch**」を入力し、表示されたら 「**Git: Fetch**」 を選択します。このコマンドは、ローカル スナップショットの起点ブランチを更新します。
1.  Visual Studio Code ウィンドウの左下隅で、**マスター** エントリをもう一度クリックします。
1.  ブランチのリストで、**origin/release** を選択します。これにより、**release** という新しいローカル ブランチが作成され、チェックアウトされます。

#### タスク 2: ブランチを削除して復元する

このタスクでは、Azure DevOps ポータルを使用して、前のタスクで作成したブランチを削除して復元します。

1.  Azure DevOps ポータルの 「**ブランチ**」 ペインの 「**マイニング**」 タブを表示している Web ブラウザーに切り替えます。 
1.  「**ブランチ**」 ペインの 「**マイニング**」 タブで、**リリース** ブランチ エントリにマウス ポインターを合わせると、右側に省略記号が表示されます。
1.  省略記号をクリックし、ポップアップ メニューで 「**ブランチの削除**」を選択し、確認を求められたら 「**削除**」をクリックします。
1.  「**ブランチ**」 ペインの 「**マイニング**」 タブで、「**すべて**」 タブを選択します。 
1.  「**ブランチ**」 ペインの 「**すべて**」 タブの 「**ブランチ名の検索**」 テキスト ボックスに、「**release**」と入力します。 
1.  新しく削除されたブランチを表すエントリを含む 「**削除されたブランチ**」 セクションを確認します。 
1.  「**削除されたブランチ**」 セクションで、マウス ポインターを**リリース** ブランチ エントリに合わせると、右側に省略記号が表示されます。
1.  ポップアップ メニューで省略記号をクリックし、「**復元**」 を選択します。

    > **注**: 正確な名前がわかっている限り、この機能を使用して、削除されたブランチを復元できます。

#### タスク 3: ブランチをロックおよびロック解除する

このタスクでは、Azure DevOps ポータルを使用して、マスター ブランチをロックおよびロック解除します。

ロックは、重要なマージと競合する可能性のある新しい変更を防止したり、ブランチを読み取り専用状態にするのに理想的です。または、ブランチ内の変更がマージされる前に確認されるようにするだけの場合は、ロックする代わりにブランチ ポリシーとプル要求を使用できます。

ロックしても、リポジトリの複製や、ブランチで行われた更新のローカル リポジトリへのフェッチが妨げられることはありません。ブランチをロックする場合は、チームにロックの理由を共有し、ロックが解除された後にブランチを操作する方法をチームが知っていることを確認してください。

1.  Azure DevOps ポータルの 「**ブランチ**」 ペインの 「**マイニング**」 タブを表示している Web ブラウザーに切り替えます。 
1.  「**ブランチ**」 ペインの 「**マイニング**」 タブで、**マスター** ブランチ エントリにマウス ポインターを合わせると、右側に省略記号が表示されます。
1.  省略記号をクリックし、ポップアップ メニューで 「**ロック**」 を選択します。
1.  「**ブランチ**」 ペインの 「**マイニング**」 タブで、**マスター** ブランチ エントリにマウス ポインターを合わせると、右側に省略記号が表示されます。
1.  省略記号をクリックし、ポップアップ メニューで 「**ロック解除**」 を選択します。

#### タスク 4: リリースをタグ付けする

このタスクでは、Azure DevOps ポータルを使用して、Azure DevOps リポジトリのリリースにタグを付けます。

製品チームは、サイトの現在のバージョンを v1.1.0-beta としてリリースすることを決定しました。 

1.  Azure DevOps ポータルの垂直ナビゲーション ペインの 「**リポジトリ**」 セクションで、「**タグ**」 を選択します。
1.  「**タグ**」 ペインで、「**新しいタグ**」 をクリックします。
1.  「**タグの作成**」 パネルの「**名前**」 テキストボックスに「**v1.1.0-beta**」と入力し、「**ベース**」 ドロップダウン リストで**マスター** エントリを選択したままにし、「**説明**」 テキスト ボックスに「**ベータリリース v1.1.0**」と入力して 「**作成**」 をクリックします。

    > **注**: これで、このリリースでプロジェクトにタグが付けられました。さまざまな理由でコミットにタグを付けることができます。Azure DevOps は、コミットを編集および削除したり、アクセス許可を管理したりする柔軟性を提供します。

### 演習 3: リポジトリの管理

この演習では、Azure DevOps ポータルを使用して、Azure DevOps リポジトリで Git リポジトリを作成および削除します。

チーム プロジェクトで Git リポジトリを作成して、プロジェクトのソース コードを管理できます。各 Git リポジトリには、プロジェクト内の他の作業から自身を分離するための独自の権限とブランチのセットがあります。

#### タスク 1: Azure DevOps から新しいリポジトリを作成する

このタスクでは、Azure DevOps ポータルを使用して、Azure DevOps リポジトリに Git リポジトリを作成します。

1.  Azure DevOps ポータルを表示している Web ブラウザーの垂直ナビゲーション ペインで、プロジェクト名のすぐ右側にある左上隅のプラス記号をクリックし、カスケード メニューで 「**新しいリポジトリ**」 をクリックします。
1.  「**リポジトリの作成**」 ペインの 「**リポジトリの種類**」 で、デフォルトの **Git** エントリをそのままにし、「**リポジトリ名**」 テキスト ボックスに「**新しいリポジトリ**」と入力し、他の設定をデフォルト値のままにして、「**作成**」 をクリックします。 

    > **注**: **README.md** という名前のファイルを作成するオプションがあります。これは、誰かが Web ブラウザーでリポジトリ ルートに移動したときにレンダリングされるデフォルトの Markdown ファイルになります。さらに、**gitignore** ファイルを使用してリポジトリを事前設定できます。このファイルは、名前付けパターンやパスに基づいて、ソース管理から無視するファイルを指定します。作成しているプロジェクトの種類に基づいて無視する一般的なパターンとパスを含む、利用可能な複数のテンプレートがあります。 

    > **注**: この時点で、リポジトリは使用可能です。これで、Visual StudioCode またはその他の gi t互換ツールを使用して、複製することができます。

#### タスク 2: Git リポジトリの削除と名前の変更

このタスクでは、Azure DevOps ポータルを使用して、Azure DevOps リポジトリ内の Git リポジトリを削除します。

場合によっては、リポジトリの名前を変更したり削除したりする必要があります。これも同様に簡単です。 

1.  Azure DevOps ポータルを表示している Web ブラウザーで、垂直ナビゲーション ペインの下部にある 「**プロジェクト設定**」 をクリックします。
1.  「**プロジェクト設定**」 垂直ナビゲーション ペインで、「**リポジトリ**」 セクションまで下にスクロールし、「**リポジトリ**」 をクリックします。
1.  「**すべてのリポジトリ**」 ペインの 「**リポジトリ**」 タブで、マウス ポインターを 「**新しいリポジトリ**」 ブランチ エントリに合わせると、右側に省略記号が表示されます。
1.  省略記号をクリックし、ポップアップ メニューで 「**削除**」 を選択し、「**新しいリポジトリの削除**」 パネルで「**新しいリポジトリ**」と入力して、「**削除**」 をクリックします。

#### レビュー

このラボでは、Azure DevOps ポータルを使用してブランチとリポジトリを管理しました。 
